{
  "name": "genie-stockbot-ai-insights",
  "description": "Genie StockBot AI-Powered Retail Insights Generator using Azure OpenAI GPT-4o",
  "tags": {
    "project": "scout-analytics",
    "environment": "production",
    "owner": "ai-engineering",
    "ai-service": "azure-openai"
  },
  "schedule": {
    "quartz_cron": "0 0 9 * * ?",
    "timezone_id": "Asia/Manila",
    "pause_status": "UNPAUSED"
  },
  "max_concurrent_runs": 1,
  "timeout_seconds": 1800,
  "new_cluster": {
    "spark_version": "13.3.x-scala2.12",
    "node_type_id": "Standard_D3_v2",
    "num_workers": 1,
    "cluster_name": "genie-stockbot-cluster",
    "spark_conf": {
      "spark.databricks.cluster.profile": "singleNode",
      "spark.master": "local[*]",
      "spark.sql.adaptive.enabled": "true"
    },
    "azure_attributes": {
      "availability": "ON_DEMAND_AZURE",
      "first_on_demand": 1,
      "spot_bid_max_price": -1
    },
    "custom_tags": {
      "Project": "Scout",
      "Environment": "Production",
      "CostCenter": "AIEngineering",
      "Service": "GenieStockBot"
    }
  },
  "libraries": [
    {
      "pypi": {
        "package": "openai==0.28.1"
      }
    },
    {
      "pypi": {
        "package": "psycopg2-binary==2.9.7"
      }
    },
    {
      "maven": {
        "coordinates": "org.postgresql:postgresql:42.6.0"
      }
    },
    {
      "pypi": {
        "package": "pandas==2.0.3"
      }
    }
  ],
  "spark_python_task": {
    "python_file": "dbfs:/FileStore/code/genie_stockbot.py",
    "parameters": [
      "--environment", "production",
      "--ai-model", "gpt-4o",
      "--log-level", "INFO"
    ]
  },
  "email_notifications": {
    "on_start": ["ai-engineering@scout.com"],
    "on_success": ["ai-engineering@scout.com", "business-intelligence@scout.com"],
    "on_failure": ["ai-engineering@scout.com", "alerts@scout.com"],
    "no_alert_for_skipped_runs": false
  },
  "webhook_notifications": {
    "on_success": [
      {
        "id": "genie-success-webhook"
      }
    ],
    "on_failure": [
      {
        "id": "genie-failure-webhook"
      }
    ]
  },
  "max_retries": 2,
  "min_retry_interval_millis": 600000,
  "retry_on_timeout": true,
  "run_as": {
    "service_principal_name": "sp-scout-ai@scout.com"
  },
  "access_control_list": [
    {
      "user_name": "ai-engineering@scout.com",
      "permission_level": "IS_OWNER"
    },
    {
      "group_name": "scout-analytics-team",
      "permission_level": "CAN_VIEW"
    },
    {
      "group_name": "business-intelligence-team",
      "permission_level": "CAN_VIEW"
    }
  ],
  "health": {
    "rules": [
      {
        "metric": "RUN_DURATION_SECONDS",
        "op": "GREATER_THAN",
        "value": 900
      }
    ]
  },
  "job_clusters": [
    {
      "job_cluster_key": "genie-ai-cluster",
      "new_cluster": {
        "spark_version": "13.3.x-scala2.12",
        "node_type_id": "Standard_D3_v2",
        "num_workers": 1,
        "cluster_name": "genie-stockbot-ai",
        "custom_tags": {
          "Project": "Scout",
          "Service": "GenieStockBot",
          "AI": "AzureOpenAI"
        }
      }
    }
  ]
}
