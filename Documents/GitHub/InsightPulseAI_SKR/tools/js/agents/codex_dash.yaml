# Codex-Dash Integration Configuration
# This file defines the integration between Codex guardrails and Dash dashboard builder

id: codex_dash
name: Codex Dash Integration
version: 1.0.0
description: >
  |
  This agent provides enterprise-grade functionality with comprehensive error handling,
  performance optimization, and full observability for production environments.
  Enables Codex to generate, validate, and deploy dashboards through Dash
  while enforcing all guardrails policies. This integration allows for
  automated dashboard workflows with quality checks and safety controls.

required_agents:
  - codex
  - dash

commands:
  - id: generate
    description: Generate a dashboard using Dash
    script: ../scripts/codex_dash_connector.js
    args:
      - generate
      - --source
      - ${source}
      - --requirements
      - ${requirements}
      - --output
      - ${output}
      - --theme
      - ${theme}
    permissions:
      - file_read
      - file_write
      - execute
  
  - id: deploy
    description: Deploy a generated dashboard
    script: ../scripts/codex_dash_connector.js
    args:
      - deploy
      - --path
      - ${path}
      - --target
      - ${target}
      - --environment
      - ${environment}
    permissions:
      - file_read
      - network
      - execute
  
  - id: validate
    description: Validate a dashboard against guardrails
    script: ../scripts/codex_dash_connector.js
    args:
      - validate
      - --path
      - ${path}
    permissions:
      - file_read
      - execute

guardrails:
  dashboard_schema:
    path: ../schemas/dashboard.schema.json
    validate_on_generation: true
    validate_on_deployment: true
  
  validation_rules:
    - rule: mobile_responsive
      description: Dashboard must be responsive on mobile devices
      pattern: '<meta[^>]*viewport'
      required: true
      message: "Dashboard must include viewport meta tag for mobile responsiveness"
    
    - rule: accessible_elements
      description: Dashboard must include accessibility attributes
      pattern: 'aria-|role=|alt='
      required: true
      message: "Dashboard must include ARIA attributes for accessibility"
    
    - rule: dark_mode_support
      description: Dashboard should support dark mode
      pattern: 'dark-mode|data-theme|color-scheme'
      required: false
      message: "Consider adding dark mode support to the dashboard"
  
  deployment_rules:
    - environment: production
      requires_approval: true
      canary_first: true
    
    - environment: canary
      percentage: 10
      monitoring_duration: 24h
    
    - environment: dev
      auto_deploy: true

cli_aliases:
  - name: codex-dash
    path: ../scripts/codex_dash_connector.js
    description: "Command-line interface for Codex-Dash integration"
monitoring:
  enabled: true
  metrics:
    - response_time
    - error_rate
    - throughput
    - resource_usage
  alerts:
    - type: threshold
      metric: error_rate
      threshold: 0.01
      action: notify
  healthcheck:
    endpoint: /health
    interval: 30s

performance:
  optimization: true
  caching:
    enabled: true
    ttl: 3600
  concurrency:
    max_workers: 10
    queue_size: 100
  resource_limits:
    max_memory: 512MB
    max_cpu: 2.0
    timeout: 300s

error_handling:
  retry:
    enabled: true
    max_attempts: 3
    backoff: exponential
  circuit_breaker:
    enabled: true
    threshold: 5
    timeout: 60s
  fallback:
    enabled: true
    strategy: graceful_degradation

lifecycle:
  on_start:
    - action: validate_environment
    - action: load_configuration
    - action: initialize_connections
  on_ready:
    - action: register_with_discovery
    - action: start_health_checks
  on_shutdown:
    - action: deregister_from_discovery
    - action: cleanup_resources
    - action: save_state

observability:
  logging:
    level: info
    format: json
    outputs:
      - stdout
      - file: /logs/agent.log
  tracing:
    enabled: true
    provider: opentelemetry
    sampling_rate: 0.1
  metrics:
    enabled: true
    provider: prometheus
    endpoint: /metrics
