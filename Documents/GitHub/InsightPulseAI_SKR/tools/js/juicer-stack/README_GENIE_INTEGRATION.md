# Juicer GENIE Integration (Chat with Data + Text-to-SQL + RAG)

This document outlines the implementation of the "Chat with Data" module inside the Juicer stack, equivalent to the GENIE component for natural language querying of structured and unstructured data.

## Overview

The Chat with Data module provides a natural language interface to the Juicer data platform, allowing users to query data from the Medallion architecture using plain English. The system uses a dual-resolution approach:

1. **Structured Approach**: Converts natural language to SQL for Medallion tables
2. **Unstructured Approach**: Uses RAG (Retrieval Augmented Generation) for fallback
3. **Hybrid Synthesis**: Combines results to provide comprehensive answers

## Architecture Components

### 1. Backend API (FastAPI)

- `/api/juicer/query` endpoint for processing natural language queries
- SQLAlchemy connector to Databricks
- RAG implementation with document retrieval
- LLM integration with multiple providers (Claude, OpenAI, DeepSeek)

### 2. Frontend UI (React)

- `JuicyChat` component with chat interface
- Interactive visualizations using Chart.js
- SQL query display with syntax highlighting
- Data table display for result exploration

### 3. Core NLP Components

- **Ask-to-SAQ**: Query rewriting to Structured Analytical Questions
- **Text-to-SQL**: Converts queries into SQL for Medallion tables
- **RAG Layer**: Hybrid semantic + keyword search for unstructured data
- **Response Formatter**: Generates visualizations and formats responses

## Implementation Steps

### 1. Setup Development Environment

```bash
# Create virtual environment
python -m venv .venv
source .venv/bin/activate

# Install dependencies
pip install fastapi uvicorn sqlalchemy pandas pydantic requests
```

### 2. Run the FastAPI Server

```bash
# Start the development server
cd /path/to/juicer-stack
python app.py
```

### 3. Build and Run the React Frontend

```bash
# Navigate to UI directory
cd /path/to/juicer-stack/ui

# Install dependencies
npm install

# Start development server
npm run dev
```

## Usage Examples

The system supports a wide range of natural language queries:

### Sales Queries
```
"Compare sales uplift for Campaign B vs. A in NCR"
"What was our revenue growth in Q1 2025 compared to Q4 2024?"
```

### Brand Analysis Queries
```
"How many brand mentions did Jollibee get last quarter?"
"What's the sentiment trend for McDonald's vs KFC?"
```

### Agent Performance Queries
```
"Who are our top performing agents by conversion rate?"
"Show me agents with declining sentiment scores"
```

### GenAI Insights Queries
```
"What insights have we gathered about customer preferences?"
"Show me all high-confidence insights about vegetarian menu items"
```

## Configuration

The system can be configured via environment variables:

```
# LLM API Keys
CLAUDE_API_KEY=your_claude_api_key
OPENAI_API_KEY=your_openai_api_key

# Databricks Configuration
DATABRICKS_HOST=your_databricks_host
DATABRICKS_TOKEN=your_databricks_token
DATABRICKS_WAREHOUSE_ID=your_warehouse_id

# RAG Configuration
JUICER_RAG_INDEX_PATH=/path/to/rag/indexes
```

## Integration with Existing Juicer Components

The Chat with Data module integrates with the existing Juicer system in the following ways:

1. **Medallion Architecture**: Connects to Bronze, Silver, Gold, and Platinum layers
2. **Databricks Integration**: Uses the same Databricks workspace and SQL endpoints
3. **GenAI Insights**: Leverages insights generated by the Insights Generation module
4. **Pulser Agent Integration**: Connects with Claudia, Maya, Kalaw, Echo, and Sunnies agents

## Future Enhancements

1. Implement production-ready RAG indexing with vector database (FAISS, Chroma)
2. Add support for multi-turn conversations with chat history context
3. Expand visualization capabilities with more chart types
4. Implement user feedback mechanisms for continuous learning
5. Add more advanced SQL generation capabilities (joins, subqueries, etc.)

## Technical Dependencies

- FastAPI for backend API
- React for frontend UI
- Chart.js for visualizations
- SQLAlchemy for database connectivity
- Pandas for data manipulation
- LLM APIs (Claude, OpenAI, DeepSeek)

## Architecture Diagram

```
┌─────────────────┐         ┌───────────────────┐         ┌────────────────────┐
│  JuicyChat UI   │         │  FastAPI Backend  │         │  Databricks SQL    │
│  (React)        │─────────┤  (/api/juicer)    │─────────┤  (Medallion Tables)│
└─────────────────┘         └───────────────────┘         └────────────────────┘
                                     │                           
                                     │                           
                            ┌────────┴─────────┐                
                            │                  │                
                    ┌───────┴────────┐ ┌───────┴────────┐      
                    │  Text-to-SQL   │ │  RAG System    │      
                    │  Generation    │ │  (Document     │      
                    └────────────────┘ │   Retrieval)   │      
                                       └────────────────┘      
                                                               
                                     │                           
                                     ▼                           
                            ┌─────────────────┐                
                            │    LLM APIs     │                
                            │ Claude/OpenAI/  │                
                            │    DeepSeek     │                
                            └─────────────────┘                
```